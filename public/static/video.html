<head>
  <link href="https://vjs.zencdn.net/8.23.4/video-js.css" rel="stylesheet" />

  <!-- If you'd like to support IE8 (for Video.js versions prior to v7) -->
  <!-- <script src="https://vjs.zencdn.net/ie8/1.1.2/videojs-ie8.min.js"></script> -->

  <link href="https://unpkg.com/video.js@7/dist/video-js.min.css" rel="stylesheet"/>
  <link href="https://unpkg.com/@videojs/themes@1/dist/fantasy/index.css" rel="stylesheet"/>

  <style>

  </style>
</head>

<body>
  <div id="videoPlayer">
  <video
    id="my-video"
    class="video-js vjs-theme-fantasy"
    controls
    preload="none"
    data-setup='{"fluid": true}'
  >
    
    <p class="vjs-no-js">
      To view this video please enable JavaScript, and consider upgrading to a
      web browser that
      <a href="https://videojs.com/html5-video-support/" target="_blank"
        >supports HTML5 video</a
      >
    </p>
  </video>
  </div>

  <script src="https://vjs.zencdn.net/8.23.4/video.min.js"></script>

  <script>
    let player = videojs("my-video");

    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const id1 = urlParams.get('id1');
    const id2 = urlParams.get('id2');
    player.src({ type: 'video/mp4', src: `/video/${id1}/${id2}` });


    const SeekBar = videojs.getComponent("SeekBar");
    let isMoving = false;
    let sharedTime;


    var myMiddleware = function (player) {
      return {
        currentTime: function (ct) {
          return isMoving ? sharedTime : ct;
        },
      };
    };

    videojs.use('video/mp4', myMiddleware);

    

    function calculateNewTime(seekbar, event) {
        let newTime;
        const distance = seekbar.calculateDistance(event);
        const liveTracker = seekbar.player_.liveTracker;
    
        if (!liveTracker || !liveTracker.isLive()) {
          newTime = distance * seekbar.player_.duration();
        
          // Don't let video end while scrubbing.
          if (newTime === seekbar.player_.duration()) {
            newTime = newTime - 0.1;
          }
        } else {
        
          if (distance >= 0.99) {
            liveTracker.seekToLiveEdge();
            return 0;
          }
          const seekableStart = liveTracker.seekableStart();
          const seekableEnd = liveTracker.liveCurrentTime();
      
          newTime = seekableStart + (distance * liveTracker.liveWindow());
      
          // Don't let video end while scrubbing.
          if (newTime >= seekableEnd) {
            newTime = seekableEnd;
          }
      
          // Compensate for precision differences so that currentTime is not less
          // than seekable start
          if (newTime <= seekableStart) {
            newTime = seekableStart + 0.1;
          }
      
          // On android seekableEnd can be Infinity sometimes,
          // this will cause newTime to be Infinity, which is
          // not a valid currentTime.
          if (newTime === Infinity) {
            return 0;
          }
        }
        return newTime;
    }

    SeekBar.prototype.getPercent = function getPercent() {
        const time = this.player_.currentTime();
        const percent = time / this.player_.duration();
        return percent >= 1 ? 1 : percent;
    };

    SeekBar.prototype.handleMouseMove = function handleMouseMove(event) {
        if (!this.player_.scrubbing()) {
          this.player_.scrubbing(true);
        }
        isMoving = true;
        let newTime = calculateNewTime(this, event);
        sharedTime = newTime;

        let minutes = Math.floor(newTime / 60);
        let seconds = Math.floor(newTime - minutes * 60);
        let x = minutes < 10 ? "0" + minutes : minutes;
        let y = seconds < 10 ? "0" + seconds : seconds;
        let format = x + ":" + y;
        player.controlBar.currentTimeDisplay.el_.innerHTML = format;

        this.update();
    };

    SeekBar.prototype.handleMouseUp = function handleMouseUp(event) {
        const doc = this.bar.el_.ownerDocument;
        isMoving = false;
        
        this.removeClass('vjs-sliding');
        this.trigger('sliderinactive');
        
        this.off(doc, 'mousemove', this.handleMouseMove_);
        this.off(doc, 'mouseup', this.handleMouseUp_);
        this.off(doc, 'touchmove', this.handleMouseMove_);
        this.off(doc, 'touchend', this.handleMouseUp_);

        let newTime = calculateNewTime(this, event);
        this.player_.currentTime(newTime);
        if (this.videoWasPlaying) {
            this.player_.play()
        } else {
            this.update();
        }
    }
    
  </script>
</body>